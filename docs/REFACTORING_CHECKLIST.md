# GMTools Python - 重构任务检查清单

## 📋 使用说明

本检查清单基于 [重构详细计划](refactoring_plan.md) 创建。
使用方法：
1. 每完成一项任务，在对应的 `[ ]` 中打上 `[x]`
2. 记录完成日期和负责人
3. 如遇到问题，记录在备注栏

---

## 🚀 第一阶段: 快速改进 (1-2 天)

**目标**: 修复所有严重问题
**预期**: Pylint 5.6 → 7.5

### Task 1.1: 修复裸 except 语句 ⏱️ 30分钟

- [ ] `network/client.py:95` - socket.close() 错误处理
  - 完成日期: ________
  - 负责人: ________
  - 备注: ________________

- [ ] `network/client.py:113` - socket.close() 错误处理
  - 完成日期: ________
  - 负责人: ________
  - 备注: ________________

- [ ] `network/client.py:121` - on_disconnect() 回调错误
  - 完成日期: ________
  - 负责人: ________
  - 备注: ________________

- [ ] `network/client.py:556` - __del__ 析构函数
  - 完成日期: ________
  - 负责人: ________
  - 备注: ________________

- [ ] `ui/login_window.py:810` - signal disconnect 错误
  - 完成日期: ________
  - 负责人: ________
  - 备注: ________________

- [ ] `ui/login_window.py:953` - client.disconnect() 错误
  - 完成日期: ________
  - 负责人: ________
  - 备注: ________________

**验证**:
```bash
flake8 network/client.py ui/login_window.py | grep "E722"
# 预期: 0 个结果
```

- [ ] 验证通过
  - 验证日期: ________
  - 验证人: ________

---

### Task 1.2: 规范导入顺序 ⏱️ 20分钟

- [ ] `main.py` - 重新排序 5 个导入语句
  - 完成日期: ________
  - 负责人: ________
  - 备注: ________________

- [ ] `network/client.py` - 3 个导入语句移到顶部
  - 完成日期: ________
  - 负责人: ________
  - 备注: ________________

- [ ] `ui/login_window.py` - 检查导入顺序
  - 完成日期: ________
  - 负责人: ________
  - 备注: ________________

**验证**:
```bash
flake8 main.py network/client.py | grep "E402"
# 预期: 0 个结果
```

- [ ] 验证通过
  - 验证日期: ________
  - 验证人: ________

---

### Task 1.3: 清理未使用的导入 ⏱️ 10分钟

- [ ] `main.py:17` - 删除 `from PyQt6.QtCore import Qt`
  - 完成日期: ________
  - 负责人: ________

- [ ] `main.py:24` - 删除 `from ui.discord_main_window import DiscordMainWindow`
  - 完成日期: ________
  - 负责人: ________

- [ ] `ui/login_window.py:31` - 删除 `QPalette, QColor`
  - 完成日期: ________
  - 负责人: ________

- [ ] `ui/login_window.py:35` - 删除 `json`
  - 完成日期: ________
  - 负责人: ________

- [ ] `ui/login_window.py:38` - 删除 `Optional`
  - 完成日期: ________
  - 负责人: ________

**验证**:
```bash
flake8 main.py ui/login_window.py | grep "F401"
# 预期: 0 个结果
```

- [ ] 验证通过
  - 验证日期: ________
  - 验证人: ________

---

### Task 1.4: 修复 f-string 滥用 ⏱️ 15分钟

- [ ] `network/client.py` - 修复 10 处 f-string 滥用
  - 行号: 186, 192, 228, 266, 294, 346, 356, 368, 375, 388
  - 完成日期: ________
  - 负责人: ________
  - 备注: ________________

**验证**:
```bash
flake8 network/client.py | grep "F541"
# 预期: 0 个结果
```

- [ ] 验证通过
  - 验证日期: ________
  - 验证人: ________

---

### Task 1.5: 清理代码格式 ⏱️ 5分钟

- [ ] 安装 black 工具
  ```bash
  pip install black
  ```
  - 完成日期: ________

- [ ] 格式化所有代码
  ```bash
  black main.py network/ ui/ modules/
  ```
  - 完成日期: ________
  - 负责人: ________

**验证**:
```bash
flake8 . --count --select=W291,W293,E303
# 预期: 0 个问题
```

- [ ] 验证通过
  - 验证日期: ________
  - 验证人: ________

---

### 第一阶段总结

- [ ] 所有任务完成
  - 完成日期: ________

- [ ] Pylint 评分检查
  ```bash
  pylint main.py --max-line-length=120
  ```
  - 评分: ________ / 10
  - 目标: >= 7.5
  - 达标: [ ] 是 [ ] 否

- [ ] 回归测试通过
  - 测试日期: ________
  - 测试人: ________
  - 问题数: ________

---

## 🎯 第二阶段: 重构优化 (3-5 天)

**目标**: 降低代码复杂度
**预期**: 复杂度降低 30-40%

### Task 2.1: 重构 GMToolsClient._receive_loop() ⏱️ 2-3小时

**当前复杂度**: 22 (D级)
**目标复杂度**: < 10 (A级)

- [ ] 步骤 1: 创建备份分支
  ```bash
  git checkout -b refactor/receive-loop
  ```
  - 完成日期: ________

- [ ] 步骤 2: 提取 `_receive_chunk()` 方法
  - 完成日期: ________
  - 负责人: ________

- [ ] 步骤 3: 提取 `_handle_connection_closed()` 方法
  - 完成日期: ________
  - 负责人: ________

- [ ] 步骤 4: 提取 `_process_chunk()` 方法
  - 完成日期: ________
  - 负责人: ________

- [ ] 步骤 5: 提取 `_handle_unpacked_data()` 方法
  - 完成日期: ________
  - 负责人: ________

- [ ] 步骤 6: 提取 `_handle_receive_error()` 方法
  - 完成日期: ________
  - 负责人: ________

- [ ] 步骤 7: 简化主函数 `_receive_loop()`
  - 完成日期: ________
  - 负责人: ________

**验证**:
```bash
radon cc network/client.py -s | grep "_receive_loop"
# 预期: 复杂度 < 10
```

- [ ] 复杂度验证通过
  - 复杂度: ________
  - 验证日期: ________

- [ ] 功能测试通过
  - 测试项: [ ] 连接测试 [ ] 接收测试 [ ] 断线重连
  - 测试日期: ________
  - 测试人: ________

---

### Task 2.2: 重构 PetModule.load_pet_data() ⏱️ 2-3小时

**当前复杂度**: 23 (D级)
**目标复杂度**: < 10 (A级)

- [ ] 步骤 1: 创建备份分支
  ```bash
  git checkout -b refactor/pet-load-data
  ```
  - 完成日期: ________

- [ ] 步骤 2: 提取 `_parse_pet_info()` 方法
  - 完成日期: ________
  - 负责人: ________

- [ ] 步骤 3: 提取 `_update_basic_info()` 方法
  - 完成日期: ________
  - 负责人: ________

- [ ] 步骤 4: 提取 `_update_attributes()` 方法
  - 完成日期: ________
  - 负责人: ________

- [ ] 步骤 5: 提取 `_update_skills()` 方法
  - 完成日期: ________
  - 负责人: ________

- [ ] 步骤 6: 简化主函数 `load_pet_data()`
  - 完成日期: ________
  - 负责人: ________

**验证**:
```bash
radon cc modules/pet_module.py -s | grep "load_pet_data"
# 预期: 复杂度 < 10
```

- [ ] 复杂度验证通过
  - 复杂度: ________
  - 验证日期: ________

- [ ] 功能测试通过
  - 测试项: [ ] 加载宠物 [ ] 显示属性 [ ] 显示技能
  - 测试日期: ________
  - 测试人: ________

---

### Task 2.3: 优化 C 级复杂度函数 ⏱️ 4-6小时

#### 2.3.1 CharacterModule.modify_character (复杂度 20 → < 10)

- [ ] 提取验证逻辑
  - 完成日期: ________
  - 负责人: ________

- [ ] 提取数据收集逻辑
  - 完成日期: ________
  - 负责人: ________

- [ ] 验证复杂度: ________
  - 验证日期: ________

---

#### 2.3.2 CustomAffixModule.modify_affixes (复杂度 20 → < 10)

- [ ] 使用数据驱动方法重构
  - 完成日期: ________
  - 负责人: ________

- [ ] 验证复杂度: ________
  - 验证日期: ________

---

#### 2.3.3 PetModule.modify_pet (复杂度 16 → < 10)

- [ ] 提取方法重构
  - 完成日期: ________
  - 负责人: ________

- [ ] 验证复杂度: ________
  - 验证日期: ________

---

#### 2.3.4 EquipmentModule.send_ornament (复杂度 14 → < 10)

- [ ] 简化条件逻辑
  - 完成日期: ________
  - 负责人: ________

- [ ] 验证复杂度: ________
  - 验证日期: ________

---

#### 2.3.5 PetModule.modify_mount (复杂度 14 → < 10)

- [ ] 提取方法重构
  - 完成日期: ________
  - 负责人: ________

- [ ] 验证复杂度: ________
  - 验证日期: ________

---

#### 2.3.6 GMToolsClient._parse_response (复杂度 12 → < 10)

- [ ] 使用策略模式重构
  - 完成日期: ________
  - 负责人: ________

- [ ] 验证复杂度: ________
  - 验证日期: ________

---

#### 2.3.7 EquipmentModule.send_pet_equipment (复杂度 12 → < 10)

- [ ] 简化逻辑重构
  - 完成日期: ________
  - 负责人: ________

- [ ] 验证复杂度: ________
  - 验证日期: ________

---

### Task 2.4: 添加单元测试 ⏱️ 1-2天

#### 测试环境搭建

- [ ] 安装测试工具
  ```bash
  pip install pytest pytest-cov pytest-mock
  ```
  - 完成日期: ________

- [ ] 创建测试目录结构
  ```bash
  mkdir -p tests/{unit,integration}
  ```
  - 完成日期: ________

---

#### 高优先级测试

- [ ] `tests/unit/test_gmtools_client.py` - 网络客户端测试
  - [ ] test_connect_success
  - [ ] test_connect_failure
  - [ ] test_send_data
  - [ ] test_receive_data
  - [ ] test_encrypt_decrypt
  - [ ] test_reconnect
  - 完成日期: ________
  - 负责人: ________
  - 覆盖率: ________%

- [ ] `tests/unit/test_dynamic_header.py` - 包头计算测试
  - [ ] test_short_data_header
  - [ ] test_long_data_header
  - [ ] test_edge_cases
  - 完成日期: ________
  - 负责人: ________
  - 覆盖率: ________%

- [ ] `tests/unit/test_base_module.py` - 基础模块测试
  - [ ] test_send_command
  - [ ] test_dict_to_lua_table
  - [ ] test_show_message
  - 完成日期: ________
  - 负责人: ________
  - 覆盖率: ________%

---

#### 中优先级测试

- [ ] `tests/unit/test_login_window.py` - 登录窗口测试
  - [ ] test_input_validation
  - [ ] test_login_flow
  - [ ] test_save_credentials
  - 完成日期: ________
  - 负责人: ________
  - 覆盖率: ________%

- [ ] `tests/unit/test_character_module.py` - 角色模块测试
  - [ ] test_data_validation
  - [ ] test_modify_operation
  - 完成日期: ________
  - 负责人: ________
  - 覆盖率: ________%

---

#### 测试验证

- [ ] 运行所有测试
  ```bash
  pytest tests/
  ```
  - 测试日期: ________
  - 通过率: ________%

- [ ] 检查覆盖率
  ```bash
  pytest --cov=network --cov=modules --cov=ui tests/
  ```
  - 检查日期: ________
  - 覆盖率: ________%
  - 目标: >= 60%
  - 达标: [ ] 是 [ ] 否

---

### 第二阶段总结

- [ ] 所有任务完成
  - 完成日期: ________

- [ ] 代码复杂度检查
  ```bash
  radon cc . -s -n C
  ```
  - D级函数数: ________ (目标: 0)
  - C级函数数: ________ (目标: < 3)
  - 达标: [ ] 是 [ ] 否

- [ ] 测试覆盖率检查
  - 覆盖率: ________%
  - 目标: >= 40%
  - 达标: [ ] 是 [ ] 否

- [ ] 回归测试通过
  - 测试日期: ________
  - 测试人: ________
  - 问题数: ________

---

## 🌟 第三阶段: 质量提升 (1 周)

**目标**: 完善文档、类型注解、工具配置
**预期**: Pylint 达到 9.0+

### Task 3.1: 添加类型注解 ⏱️ 2-3天

#### 核心模块类型注解

- [ ] `network/client.py` - GMToolsClient 类
  - [ ] 类属性类型注解
  - [ ] 方法参数和返回值注解
  - 完成日期: ________
  - 负责人: ________

- [ ] `network/dynamic_header.py` - 函数类型注解
  - 完成日期: ________
  - 负责人: ________

- [ ] `modules/base_module.py` - BaseModule 类
  - [ ] 类属性类型注解
  - [ ] 方法参数和返回值注解
  - 完成日期: ________
  - 负责人: ________

- [ ] `ui/login_window.py` - LoginWindow 类
  - [ ] 主要方法类型注解
  - 完成日期: ________
  - 负责人: ________

- [ ] `ui/discord_main_window.py` - DiscordMainWindow 类
  - [ ] 主要方法类型注解
  - 完成日期: ________
  - 负责人: ________

---

#### 功能模块类型注解

- [ ] `modules/character_module.py`
  - 完成日期: ________
  - 负责人: ________

- [ ] `modules/pet_module.py`
  - 完成日期: ________
  - 负责人: ________

- [ ] `modules/gift_module.py`
  - 完成日期: ________
  - 负责人: ________

- [ ] `modules/equipment_module.py`
  - 完成日期: ________
  - 负责人: ________

---

#### 类型检查验证

- [ ] 安装 mypy
  ```bash
  pip install mypy
  ```
  - 完成日期: ________

- [ ] 运行类型检查
  ```bash
  mypy network/ modules/ ui/ --ignore-missing-imports
  ```
  - 检查日期: ________
  - 错误数: ________
  - 目标: 0 个错误
  - 达标: [ ] 是 [ ] 否

---

### Task 3.2: 补充文档字符串 ⏱️ 2-3天

#### 核心类文档

- [ ] `GMToolsClient` 类文档
  - [ ] 类级别文档
  - [ ] 所有公共方法文档
  - 完成日期: ________
  - 负责人: ________

- [ ] `BaseModule` 类文档
  - [ ] 类级别文档
  - [ ] 所有公共方法文档
  - 完成日期: ________
  - 负责人: ________

- [ ] `LoginWindow` 类文档
  - [ ] 类级别文档
  - [ ] 主要方法文档
  - 完成日期: ________
  - 负责人: ________

---

#### 功能模块文档

- [ ] CharacterModule 文档
  - 完成日期: ________
  - 负责人: ________

- [ ] PetModule 文档
  - 完成日期: ________
  - 负责人: ________

- [ ] GiftModule 文档
  - 完成日期: ________
  - 负责人: ________

---

#### API 文档生成

- [ ] 安装 Sphinx
  ```bash
  pip install sphinx sphinx-rtd-theme
  ```
  - 完成日期: ________

- [ ] 初始化文档项目
  ```bash
  sphinx-quickstart docs
  ```
  - 完成日期: ________

- [ ] 生成 HTML 文档
  ```bash
  cd docs && make html
  ```
  - 完成日期: ________

- [ ] 文档审核通过
  - 审核日期: ________
  - 审核人: ________

---

### Task 3.3: 配置开发工具 ⏱️ 1-2小时

#### Pre-commit Hook

- [ ] 创建 `.pre-commit-config.yaml`
  - 完成日期: ________
  - 负责人: ________

- [ ] 安装 pre-commit
  ```bash
  pip install pre-commit
  pre-commit install
  ```
  - 完成日期: ________

- [ ] 测试 pre-commit
  ```bash
  pre-commit run --all-files
  ```
  - 测试日期: ________
  - 结果: [ ] 通过 [ ] 失败
  - 问题: ________________

---

#### Pylint 配置

- [ ] 创建 `.pylintrc`
  - 完成日期: ________
  - 负责人: ________

- [ ] 测试 pylint 配置
  ```bash
  pylint main.py --rcfile=.pylintrc
  ```
  - 测试日期: ________
  - 评分: ________ / 10

---

#### VS Code 配置

- [ ] 创建 `.vscode/settings.json`
  - 完成日期: ________
  - 负责人: ________

- [ ] 团队成员确认配置生效
  - [ ] 成员 1: ________ 确认日期: ________
  - [ ] 成员 2: ________ 确认日期: ________
  - [ ] 成员 3: ________ 确认日期: ________

---

#### EditorConfig

- [ ] 创建 `.editorconfig`
  - 完成日期: ________
  - 负责人: ________

---

### Task 3.4: 持续集成配置 ⏱️ 2-3小时

- [ ] 创建 `.github/workflows/quality.yml`
  - 完成日期: ________
  - 负责人: ________

- [ ] 配置 GitHub Actions
  - 完成日期: ________
  - 负责人: ________

- [ ] 测试 CI 流程
  - [ ] 代码风格检查通过
  - [ ] Pylint 检查通过
  - [ ] Flake8 检查通过
  - [ ] Mypy 检查通过
  - [ ] 测试执行通过
  - 测试日期: ________
  - 测试人: ________

- [ ] 配置 Codecov
  - 完成日期: ________
  - 负责人: ________

---

### 第三阶段总结

- [ ] 所有任务完成
  - 完成日期: ________

- [ ] Pylint 评分检查
  ```bash
  pylint network/ modules/ ui/ --rcfile=.pylintrc
  ```
  - 评分: ________ / 10
  - 目标: >= 9.0
  - 达标: [ ] 是 [ ] 否

- [ ] 文档覆盖率检查
  - 覆盖率: ________%
  - 目标: >= 80%
  - 达标: [ ] 是 [ ] 否

- [ ] 类型注解覆盖率
  - 覆盖率: ________%
  - 目标: >= 70%
  - 达标: [ ] 是 [ ] 否

---

## ✅ 最终验收

### 质量指标验收

- [ ] Pylint 评分 >= 9.0
  - 实际: ________ / 10
  - 验收人: ________
  - 验收日期: ________

- [ ] Flake8 问题 < 10
  - 实际: ________ 个
  - 验收人: ________
  - 验收日期: ________

- [ ] Bandit 安全问题 = 0
  - 实际: ________ 个
  - 验收人: ________
  - 验收日期: ________

- [ ] D级复杂度函数 = 0
  - 实际: ________ 个
  - 验收人: ________
  - 验收日期: ________

- [ ] C级复杂度函数 <= 3
  - 实际: ________ 个
  - 验收人: ________
  - 验收日期: ________

- [ ] 测试覆盖率 >= 60%
  - 实际: ________%
  - 验收人: ________
  - 验收日期: ________

---

### 功能验收

- [ ] 登录功能正常
  - 测试人: ________
  - 测试日期: ________

- [ ] 角色管理功能正常
  - 测试人: ________
  - 测试日期: ________

- [ ] 宠物管理功能正常
  - 测试人: ________
  - 测试日期: ________

- [ ] 礼包发放功能正常
  - 测试人: ________
  - 测试日期: ________

- [ ] 装备管理功能正常
  - 测试人: ________
  - 测试日期: ________

- [ ] 网络通信正常
  - 测试人: ________
  - 测试日期: ________

---

### 性能验收

- [ ] 启动时间无明显增加
  - 对比结果: 重构前 ________ 秒 vs 重构后 ________ 秒
  - 验收人: ________
  - 验收日期: ________

- [ ] 内存占用无明显增加
  - 对比结果: 重构前 ________ MB vs 重构后 ________ MB
  - 验收人: ________
  - 验收日期: ________

- [ ] 响应速度无明显下降
  - 对比结果: ________________
  - 验收人: ________
  - 验收日期: ________

---

### 最终批准

- [ ] 开发团队确认
  - 确认人: ________
  - 确认日期: ________
  - 签名: ________

- [ ] 测试团队确认
  - 确认人: ________
  - 确认日期: ________
  - 签名: ________

- [ ] 项目负责人批准
  - 批准人: ________
  - 批准日期: ________
  - 签名: ________

---

## 📝 备注和问题记录

### 遇到的问题

| 日期 | 问题描述 | 解决方案 | 负责人 | 状态 |
|------|---------|---------|--------|------|
| ____ | _______ | _______ | ______ | ____ |
| ____ | _______ | _______ | ______ | ____ |
| ____ | _______ | _______ | ______ | ____ |

### 延期说明

| 任务 | 原计划 | 实际完成 | 延期原因 | 责任人 |
|------|--------|---------|---------|--------|
| ____ | ______ | _______ | _______ | ______ |
| ____ | ______ | _______ | _______ | ______ |

### 改进建议

| 日期 | 建议内容 | 提出人 | 处理状态 |
|------|---------|--------|---------|
| ____ | _______ | ______ | _______ |
| ____ | _______ | ______ | _______ |

---

**检查清单版本**: v1.0
**最后更新**: 2025-11-16
**创建人**: Claude Code Agent
